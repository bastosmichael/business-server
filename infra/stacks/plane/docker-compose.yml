version: '3.8'

services:
  plane-db:
    image: postgres:15
    container_name: plane-db
    restart: unless-stopped
    environment:
      - POSTGRES_DB=plane
      - POSTGRES_USER=plane
      - POSTGRES_PASSWORD=plane
    volumes:
      - /opt/plane/db:/var/lib/postgresql/data

  plane-redis:
    image: redis:7
    container_name: plane-redis
    restart: unless-stopped

  plane-api:
    image: makeplane/plane-backend:latest
    container_name: plane-api
    restart: unless-stopped
    ports:
      - "8005:8000"
    environment:
      - DATABASE_URL=postgresql://plane:plane@plane-db:5432/plane
      - REDIS_URL=redis://plane-redis:6379/0
      - SECRET_KEY=change-me
      - ALLOWED_HOSTS=*
      - CORS_ALLOWED_ORIGINS=*
    depends_on:
      - plane-db
      - plane-redis

  plane-worker:
    image: makeplane/plane-worker:latest
    container_name: plane-worker
    restart: unless-stopped
    environment:
      - DATABASE_URL=postgresql://plane:plane@plane-db:5432/plane
      - REDIS_URL=redis://plane-redis:6379/0
      - SECRET_KEY=change-me
    depends_on:
      - plane-db
      - plane-redis

  plane-web:
    image: makeplane/plane-frontend:latest
    container_name: plane-web
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      - NEXT_PUBLIC_API_BASE_URL=http://localhost:8005
    depends_on:
      - plane-api
